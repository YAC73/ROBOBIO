<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOYAM - Assistant IA</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d1b69 50%, #0a0a0a 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .chatbot-container {
            width: 100%;
            max-width: 450px;
            background: rgba(26, 26, 26, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(138, 43, 226, 0.3), 0 10px 30px rgba(255, 152, 0, 0.2);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 600px;
            backdrop-filter: blur(10px);
            animation: slideUp 0.5s ease-out;
            border: 1px solid rgba(138, 43, 226, 0.3);
        }

        @keyframes slideUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .chat-header {
            background: linear-gradient(135deg, #8a2be2 0%, #ff9800 100%);
            color: white;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 4px 20px rgba(138, 43, 226, 0.4);
            position: relative;
            overflow: hidden;
        }

        .chat-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 152, 0, 0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .avatar {
            width: 50px;
            height: 50px;
            background: #1a1a1a;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #ff9800;
            font-size: 20px;
            position: relative;
            z-index: 1;
            border: 2px solid #ff9800;
        }

        .avatar::after {
            content: '';
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 12px;
            height: 12px;
            background: #4ade80;
            border-radius: 50%;
            border: 2px solid #1a1a1a;
        }

        .header-info h2 {
            font-size: 22px;
            margin-bottom: 4px;
            position: relative;
            z-index: 1;
        }

        .header-info p {
            font-size: 14px;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .voice-indicator {
            margin-left: auto;
            display: flex;
            gap: 3px;
            align-items: center;
            padding: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .voice-indicator:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .voice-indicator.active {
            background: rgba(255, 255, 255, 0.3);
        }

        .voice-bar {
            width: 3px;
            height: 20px;
            background: white;
            border-radius: 3px;
            animation: wave 1s ease-in-out infinite;
        }

        .voice-bar:nth-child(2) {
            animation-delay: 0.1s;
            height: 25px;
        }

        .voice-bar:nth-child(3) {
            animation-delay: 0.2s;
            height: 18px;
        }

        @keyframes wave {
            0%, 100% {
                transform: scaleY(0.5);
                opacity: 0.5;
            }
            50% {
                transform: scaleY(1);
                opacity: 1;
            }
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: #0a0a0a;
        }

        .chat-messages::-webkit-scrollbar {
            width: 8px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: rgba(138, 43, 226, 0.1);
            border-radius: 10px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #8a2be2, #ff9800);
            border-radius: 10px;
        }

        .message {
            display: flex;
            gap: 10px;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            word-wrap: break-word;
            position: relative;
        }

        .message.bot .message-content {
            background: linear-gradient(135deg, #8a2be2 0%, #6a1b9a 100%);
            color: white;
            border-bottom-left-radius: 4px;
            box-shadow: 0 4px 15px rgba(138, 43, 226, 0.3);
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            color: white;
            border-bottom-right-radius: 4px;
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);
        }

        .calendar-widget {
            background: rgba(26, 26, 26, 0.9);
            border-radius: 12px;
            padding: 15px;
            margin-top: 10px;
            border: 1px solid rgba(138, 43, 226, 0.3);
        }

        .calendar-header {
            color: #ff9800;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }

        .time-slots {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .time-slot {
            padding: 8px;
            background: rgba(138, 43, 226, 0.2);
            border: 1px solid rgba(138, 43, 226, 0.4);
            border-radius: 8px;
            color: white;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
        }

        .time-slot:hover {
            background: linear-gradient(135deg, #8a2be2, #ff9800);
            transform: scale(1.05);
        }

        .time-slot.selected {
            background: linear-gradient(135deg, #8a2be2, #ff9800);
            box-shadow: 0 4px 10px rgba(138, 43, 226, 0.5);
        }

        .confirm-button {
            width: 100%;
            margin-top: 10px;
            padding: 10px;
            background: linear-gradient(135deg, #4ade80, #22c55e);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .confirm-button:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 15px rgba(74, 222, 128, 0.4);
        }

        .typing-indicator {
            display: none;
            align-items: center;
            gap: 4px;
            padding: 12px 16px;
            background: linear-gradient(135deg, #8a2be2 0%, #6a1b9a 100%);
            border-radius: 18px;
            border-bottom-left-radius: 4px;
            width: fit-content;
            box-shadow: 0 4px 15px rgba(138, 43, 226, 0.3);
        }

        .typing-indicator.active {
            display: flex;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.5;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        .chat-input-container {
            padding: 20px;
            background: #1a1a1a;
            border-top: 1px solid rgba(138, 43, 226, 0.3);
        }

        .input-wrapper {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid rgba(138, 43, 226, 0.3);
            background: rgba(26, 26, 26, 0.8);
            color: white;
            border-radius: 25px;
            outline: none;
            font-size: 15px;
            transition: all 0.3s ease;
        }

        .chat-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .chat-input:focus {
            border-color: #ff9800;
            box-shadow: 0 0 0 3px rgba(255, 152, 0, 0.2);
            background: rgba(26, 26, 26, 0.95);
        }

        .send-button, .mic-button {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #8a2be2 0%, #ff9800 100%);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .send-button:hover, .mic-button:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 20px rgba(138, 43, 226, 0.5), 0 3px 10px rgba(255, 152, 0, 0.3);
        }

        .send-button:active, .mic-button:active {
            transform: scale(0.95);
        }

        .mic-button.recording {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }
            70% {
                box-shadow: 0 0 0 20px rgba(239, 68, 68, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
            }
        }

        .quick-actions {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .quick-action {
            padding: 8px 14px;
            background: rgba(26, 26, 26, 0.8);
            border: 1px solid rgba(138, 43, 226, 0.3);
            border-radius: 20px;
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quick-action:hover {
            background: linear-gradient(135deg, #8a2be2 0%, #ff9800 100%);
            color: white;
            border-color: transparent;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(138, 43, 226, 0.3);
        }

        @media (max-width: 480px) {
            .chatbot-container {
                height: 100vh;
                max-width: 100%;
                border-radius: 0;
            }
        }
    </style>
</head>
<body>
    <div class="chatbot-container">
        <div class="chat-header">
            <div class="avatar">N</div>
            <div class="header-info">
                <h2>NOYAM</h2>
                <p>Assistant IA • En ligne</p>
            </div>
            <div class="voice-indicator" id="voiceToggle" title="Activer/Désactiver la voix">
                <div class="voice-bar"></div>
                <div class="voice-bar"></div>
                <div class="voice-bar"></div>
            </div>
        </div>

        <div class="chat-messages" id="chatMessages">
            <div class="message bot">
                <div class="message-content">
                    Bonjour ! Je suis NOYAM, votre consultante IA spécialisée en automatisation et intelligence artificielle sur mesure. Chaque solution que nous créons est unique et adaptée à vos besoins. Je peux organiser un audit gratuit pour analyser vos processus. Comment puis-je vous accompagner ?
                </div>
            </div>
        </div>

        <div class="typing-indicator" id="typingIndicator">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
        </div>

        <div class="chat-input-container">
            <div class="quick-actions">
                <button class="quick-action" onclick="sendQuickAction('Demander un audit gratuit')">🎯 Audit Gratuit</button>
                <button class="quick-action" onclick="sendQuickAction('Solutions IA sur mesure')">🤖 Solutions IA</button>
                <button class="quick-action" onclick="sendQuickAction('Automatisation de processus')">⚡ Automatisation</button>
                <button class="quick-action" onclick="sendQuickAction('Obtenir un devis personnalisé')">💎 Devis</button>
            </div>
            <div class="input-wrapper">
                <input 
                    type="text" 
                    class="chat-input" 
                    id="chatInput" 
                    placeholder="Tapez votre message..."
                    onkeypress="handleKeyPress(event)"
                >
                <button class="mic-button" id="micButton" onclick="toggleVoiceRecording()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                        <line x1="12" y1="19" x2="12" y2="23"></line>
                        <line x1="8" y1="23" x2="16" y2="23"></line>
                    </svg>
                </button>
                <button class="send-button" onclick="sendMessage()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script>
        let voiceEnabled = true;
        let selectedVoice = null;
        let recognition = null;
        let isRecording = false;
        let awaitingEmail = false;
        let userEmail = '';
        let selectedSlot = null;
        let appointmentData = {};

        // Initialisation de la synthèse vocale
        function initVoice() {
            if ('speechSynthesis' in window) {
                speechSynthesis.onvoiceschanged = () => {
                    const voices = speechSynthesis.getVoices();
                    selectedVoice = voices.find(voice => 
                        voice.lang.includes('fr') && 
                        (voice.name.includes('female') || voice.name.includes('femme') || voice.name.includes('Marie') || voice.name.includes('Amélie'))
                    ) || voices.find(voice => voice.lang.includes('fr')) || voices[0];
                };
            }

            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.lang = 'fr-FR';
                recognition.continuous = false;
                recognition.interimResults = false;

                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('chatInput').value = transcript;
                    sendMessage();
                    stopRecording();
                };

                recognition.onerror = (event) => {
                    console.error('Erreur de reconnaissance vocale:', event.error);
                    stopRecording();
                };

                recognition.onend = () => {
                    stopRecording();
                };
            }
        }

        function toggleVoiceRecording() {
            if (isRecording) {
                stopRecording();
            } else {
                startRecording();
            }
        }

        function startRecording() {
            if (recognition) {
                recognition.start();
                isRecording = true;
                document.getElementById('micButton').classList.add('recording');
            } else {
                alert('La reconnaissance vocale n\'est pas supportée par votre navigateur.');
            }
        }

        function stopRecording() {
            if (recognition && isRecording) {
                recognition.stop();
                isRecording = false;
                document.getElementById('micButton').classList.remove('recording');
            }
        }

        function speak(text) {
            if (voiceEnabled && 'speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.voice = selectedVoice;
                utterance.rate = 1;
                utterance.pitch = 1.1;
                utterance.volume = 1;
                speechSynthesis.speak(utterance);
            }
        }

        document.getElementById('voiceToggle').addEventListener('click', () => {
            voiceEnabled = !voiceEnabled;
            document.getElementById('voiceToggle').classList.toggle('active', voiceEnabled);
            if (voiceEnabled) {
                speak('Voix activée');
            }
        });

        // Validation email
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        // Affichage du calendrier
        function showCalendar() {
            const chatMessages = document.getElementById('chatMessages');
            const calendarDiv = document.createElement('div');
            calendarDiv.className = 'message bot';
            
            const timeSlots = [
                'Lun 10h00', 'Lun 14h00', 'Lun 16h00',
                'Mar 09h00', 'Mar 11h00', 'Mar 15h00',
                'Mer 10h00', 'Mer 14h00', 'Mer 16h00',
                'Jeu 09h00', 'Jeu 11h00', 'Jeu 15h00',
                'Ven 10h00', 'Ven 14h00', 'Ven 16h00'
            ];
            
            let slotsHTML = '<div class="message-content"><div class="calendar-widget"><div class="calendar-header">📅 Sélectionnez votre créneau</div><div class="time-slots">';
            
            timeSlots.forEach(slot => {
                slotsHTML += `<div class="time-slot" onclick="selectSlot('${slot}')">${slot}</div>`;
            });
            
            slotsHTML += '</div><button class="confirm-button" onclick="confirmAppointment()">Confirmer le rendez-vous</button></div></div>';
            
            calendarDiv.innerHTML = slotsHTML;
            chatMessages.appendChild(calendarDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function selectSlot(slot) {
            document.querySelectorAll('.time-slot').forEach(el => el.classList.remove('selected'));
            event.target.classList.add('selected');
            selectedSlot = slot;
            appointmentData.slot = slot;
        }

        function confirmAppointment() {
            if (!selectedSlot) {
                addMessage('⚠️ Veuillez sélectionner un créneau avant de confirmer.', 'bot');
                return;
            }
            
            addMessage(`✅ Parfait ! Votre audit gratuit est confirmé pour ${selectedSlot}. Vous recevrez une confirmation par email à ${userEmail} avec le lien de visioconférence. À très bientôt !`, 'bot');
            
            console.log('Rendez-vous confirmé:', appointmentData);
            
            awaitingEmail = false;
            selectedSlot = null;
            appointmentData = {};
        }

        // Base de connaissances
        const responses = {
            'agent': {
                keywords: ['agent', 'créer', 'création', 'ia', 'assistant', 'bot', 'intelligence'],
                response: 'Nous développons des agents IA sur mesure adaptés à vos besoins spécifiques. Chaque solution est unique : agents conversationnels, assistants virtuels, agents d\'analyse de données, ou systèmes de décision automatisés. Je peux organiser un audit gratuit pour identifier la solution IA idéale pour votre entreprise. Souhaitez-vous planifier cet audit ?'
            },
            'automatisation': {
                keywords: ['automatisation', 'automatiser', 'workflow', 'processus', 'tâche', 'optimisation'],
                response: 'L\'automatisation de vos processus métiers nécessite une analyse approfondie pour maximiser le ROI. Nous réalisons un audit complet de vos workflows actuels pour identifier les opportunités d\'optimisation : RPA, intégrations API, orchestration de données, et plus. Chaque solution est dimensionnée selon vos volumes et complexité. Puis-je programmer un audit gratuit pour évaluer vos besoins ?'
            },
            'audit': {
                keywords: ['audit', 'analyse', 'évaluation', 'diagnostic', 'étude', 'consultation', 'gratuit'],
                response: 'Notre audit gratuit et sans engagement comprend : analyse de vos processus actuels, identification des opportunités d\'automatisation et d\'IA, estimation du ROI potentiel, et proposition d\'architecture technique personnalisée. L\'audit dure environ 2h et peut se faire en présentiel ou en visio. Quand seriez-vous disponible pour cet audit ?'
            },
            'tarif': {
                keywords: ['prix', 'tarif', 'coût', 'budget', 'devis', 'combien', 'montant', 'investissement'],
                response: 'Chaque projet étant unique, nous établissons des devis personnalisés après audit de vos besoins. Nos solutions sont modulaires et évolutives pour s\'adapter à votre budget et croissance. Le devis inclut : développement, déploiement, formation, et support. L\'audit initial est gratuit et vous recevrez un devis détaillé sous 48h. Voulez-vous planifier votre audit ?'
            },
            'rdv': {
                keywords: ['rdv', 'rendez-vous', 'planifier', 'organiser', 'programmer', 'quand', 'disponible'],
                response: 'Excellente initiative ! Pour planifier votre audit gratuit, je vais avoir besoin de quelques informations.'
            }
        };

        function getBotResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            if (awaitingEmail) {
                if (validateEmail(message)) {
                    userEmail = message;
                    awaitingEmail = false;
                    appointmentData.email = userEmail;
                    
                    setTimeout(() => {
                        showCalendar();
                    }, 1000);
                    
                    return `Parfait ! J'ai bien noté votre email : ${userEmail}. Je vous affiche maintenant les créneaux disponibles pour votre audit gratuit à distance.`;
                } else {
                    return 'L\'adresse email semble incorrecte. Pouvez-vous vérifier et me la redonner ? (exemple: nom@entreprise.com)';
                }
            }
            
            for (const [key, data] of Object.entries(responses)) {
                if (data.keywords.some(keyword => lowerMessage.includes(keyword))) {
                    if ((lowerMessage.includes('rdv') || lowerMessage.includes('rendez-vous') || 
                         lowerMessage.includes('planifier') || lowerMessage.includes('oui') || 
                         lowerMessage.includes('organiser') || lowerMessage.includes('programmer') ||
                         lowerMessage.includes('quand') || lowerMessage.includes('disponible')) &&
                        !awaitingEmail && 
                        (key === 'rdv' || key === 'audit' || lowerMessage.includes('audit'))) {
                        awaitingEmail = true;
                        return data.response + '\n\n📧 Pour confirmer votre rendez-vous, j\'ai besoin de votre adresse email professionnelle. Pouvez-vous me la communiquer ?';
                    }
                    return data.response;
                }
            }
            
            if (lowerMessage.includes('bonjour') || lowerMessage.includes('salut') || lowerMessage.includes('hello')) {
                return 'Bonjour ! Je suis NOYAM, votre consultante dédiée en solutions IA et automatisation. Nous créons des solutions sur mesure après un audit approfondi de vos besoins. Cet audit peut se faire entièrement à distance. Souhaitez-vous que je vous montre les créneaux disponibles ?';
            }
            
            if (lowerMessage.includes('merci')) {
                return 'Je vous en prie ! C\'est un plaisir de vous accompagner. Si vous souhaitez planifier votre audit gratuit à distance, je peux vous montrer directement les créneaux disponibles. N\'hésitez pas !';
            }
            
            if (lowerMessage.includes('au revoir') || lowerMessage.includes('bye')) {
                return 'Au revoir ! N\'hésitez pas à revenir pour planifier votre audit gratuit à distance. Nous serons ravis de transformer vos processus avec l\'IA et l\'automatisation. À très bientôt !';
            }
            
            return 'Votre demande mérite une analyse personnalisée. Nous créons des solutions sur mesure après étude de vos besoins spécifiques. Je peux organiser un audit gratuit pour comprendre vos objectifs et vous proposer une solution adaptée. Quand seriez-vous disponible pour en discuter ?';
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addMessage(message, 'user');
            input.value = '';
            
            const typingIndicator = document.getElementById('typingIndicator');
            typingIndicator.classList.add('active');
            
            setTimeout(() => {
                typingIndicator.classList.remove('active');
                const response = getBotResponse(message);
                addMessage(response, 'bot');
                speak(response);